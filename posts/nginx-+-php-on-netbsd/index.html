<!DOCTYPE html>
<html lang="en">

<head>
    
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="HandheldFriendly" content="True" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta name="generator" content="Hugo 0.76.2" />


<link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/amzrk2/cdn-stcapi@1/favicons/favicon.ico" />


<title>Installation de Nginx et PHP sur NetBSD - Hugo (ShinoYasx)&#39;s blog</title>




<meta property="og:title" content="Installation de Nginx et PHP sur NetBSD" />
<meta property="og:description" content="Introduction Vous avez installé NetBSD sur votre grille-pain, mais vous ne savez pas quoi en faire ? Ne cherchez plus! Grâce à cet article vous pourrez héberger votre site web sur votre merveilleux appareil à fabriquer des toast.
Cet article va traiter de l&rsquo;installation du gestionnaire de paquets pkgin, de nginx et de php, ainsi de la configuration de ces derniers.
Installation de pkgin Si vous avez déjà pkgin installé sur votre NetBSD, vous pouvez passer à la section suivante." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shinoyasx.github.io/posts/nginx-&#43;-php-on-netbsd/" />
<meta property="article:published_time" content="2020-10-09T02:47:02+02:00" />
<meta property="article:modified_time" content="2020-10-09T02:47:02+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Installation de Nginx et PHP sur NetBSD"/>
<meta name="twitter:description" content="Introduction Vous avez installé NetBSD sur votre grille-pain, mais vous ne savez pas quoi en faire ? Ne cherchez plus! Grâce à cet article vous pourrez héberger votre site web sur votre merveilleux appareil à fabriquer des toast.
Cet article va traiter de l&rsquo;installation du gestionnaire de paquets pkgin, de nginx et de php, ainsi de la configuration de ces derniers.
Installation de pkgin Si vous avez déjà pkgin installé sur votre NetBSD, vous pouvez passer à la section suivante."/>



<style>
    @media (prefers-color-scheme: dark) {
        body[data-theme='auto'] img {
            filter: brightness(60%);
        }
    }

    body[data-theme='dark'] img {
        filter: brightness(60%);
    }
</style>



<link rel="stylesheet" href="https://shinoyasx.github.io/assets/css/fuji.min.css" />





</head>

<body data-theme="auto">
    <script data-cfasync="false">
  
  var fujiThemeData = localStorage.getItem('fuji_data-theme');
  
  if (!fujiThemeData) {
    localStorage.setItem('fuji_data-theme', 'auto');
  } else {
    
    if (fujiThemeData !== 'auto') {
      document.body.setAttribute('data-theme', fujiThemeData === 'dark' ? 'dark' : 'light');
    }
  }
</script>

    <header>
    <div class="container-lg clearfix">
        <div class="col-12 header">
            <a class="title-main" href="https://shinoyasx.github.io/">Hugo (ShinoYasx)&#39;s blog</a>
            
        </div>
    </div>
</header>

    <main>
        <div class="container-lg clearfix">
            
            <div class="col-12 col-md-9 float-left content">
                
<article>
    
    <h2 class="post-item post-title">
        <a href="https://shinoyasx.github.io/posts/nginx-&#43;-php-on-netbsd/">Installation de Nginx et PHP sur NetBSD</a>
    </h2>
    <div class="post-item post-meta">
        <span><i class="iconfont icon-today-sharp"></i>&nbsp;2020-10-09</span><span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;No tag</span>

    </div>
    
    
    <div class="post-content markdown-body">
        <h2 id="introduction">Introduction</h2>
<p>Vous avez installé NetBSD sur votre grille-pain, mais vous ne savez pas quoi en faire ? Ne cherchez plus! Grâce à cet article vous pourrez héberger votre site web sur votre merveilleux appareil à fabriquer des toast.</p>
<p>Cet article va traiter de l&rsquo;installation du gestionnaire de paquets <a href="https://pkgin.net" target="_blank">pkgin</a>, de <a href="https://www.nginx.com" target="_blank">nginx</a> et de <a href="https://www.php.net" target="_blank">php</a>, ainsi de la configuration de ces derniers.</p>
<h2 id="installation-de-pkgin">Installation de pkgin</h2>
<p>Si vous avez déjà pkgin installé sur votre NetBSD, vous pouvez passer à la section suivante.</p>
<p>pkgin est un gestionnaire de paquets pour NetBSD, à la manière de apt-get si vous avez déjà touché à Debian ou Ubuntu, pacman pour Archlinux, yum pour Fedora et CentOS, &hellip;</p>
<p>Pour l&rsquo;installer, on va utiliser sa version précompilée fournie par NetBSD. La commande <code>pkg_add</code>, de l&rsquo;outil <a href="https://www.netbsd.org/docs/pkgsrc/" target="_blank">pkgsrc</a> permet d&rsquo;installer un paquet à partir d&rsquo;un URL. On peut définir la variable d&rsquo;environnement <code>PKG_PATH</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">export PKG_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://ftp.netbsd.org/pub/pkgsrc/packages/NetBSD/</span><span style="color:#66d9ef">$(</span>uname -p<span style="color:#66d9ef">)</span><span style="color:#e6db74">/</span><span style="color:#66d9ef">$(</span>uname -r<span style="color:#66d9ef">)</span><span style="color:#e6db74">/All&#34;</span>
</code></pre></div><p>Et maintenant, on va installer pkgin</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">pkg_add pkgin
</code></pre></div><p>On peut éventuellement éditer la configuration de pkgin</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">vi /usr/pkg/etc/pkgin/repositories.conf
</code></pre></div><p>Je change de <code>$arch</code> vers <code>aarch64</code> dans mon cas car je tourne sur un Raspberry Pi 3, sinon renseigner votre architecture (<code>uname -p</code>)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">https://cdn.netbsd.org/pub/pkgsrc/packages/NetBSD/aarch64/9.0/All</span>
</code></pre></div><p>Maintenant on met à jour la liste des paquets</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">pkgin update
</code></pre></div><p>Ca y est, vous avez un gestionnaire de paquets tout beau, tout neuf! Passons maintenant au vif du sujet.</p>
<h2 id="php-fpm">PHP-FPM</h2>
<p>PHP-FPM (FastCGI Process Manager) est une API permettant de connecter un serveur web (Nginx dans notre cas) et PHP, via l&rsquo;utilisation d&rsquo;un socket.</p>
<h3 id="installation-de-php-fpm">Installation de PHP-FPM</h3>
<p>Pour l&rsquo;installer, rien de plus simple</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">pkgin in php74-fpm
</code></pre></div><p>Vous remarquerez le <em>74</em> dans <em>php74-fpm</em>, il s&rsquo;agit en fait de la version 7.4 de PHP. Vous pouvez faire un <code>pkgin search php</code> pour chercher une version plus récente de <em>php-fpm</em>, PHP 7.4 étant le dernier à date d&rsquo;écriture.</p>
<h3 id="configuration-de-php-fpm">Configuration de PHP-FPM</h3>
<p>On remarquera que le gentil monsieur nous dit quoi faire, en effet dans le terminal on peut lire</p>
<pre><code class="language-console" data-lang="console">The following files should be created for php74-fpm-7.4.10nb4:

        /etc/rc.d/php_fpm (m=0755)
            [/usr/pkg/share/examples/rc.d/php_fpm]
</code></pre><p>Alors on peut simplement copier le fichier <code>php_fpm</code> dans <code>/etc/rc.d/</code>, étant le fichier d&rsquo;initialisation du serveur (celui qui permet le démarrage, l&rsquo;arrêt, le redémarage, &hellip; de php-fpm)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cp /usr/pkg/share/examples/rc.d/php_fpm /etc/rc.d/php_fpm
</code></pre></div><p>On doit maintenant rajouter la règle d&rsquo;initialisation dans <code>/etc/rc.conf</code>. À la fin, ajouter</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">php_fpm</span><span style="color:#f92672">=</span><span style="color:#e6db74">YES</span>
</code></pre></div><p>Maintenant il ne nous reste plus qu&rsquo;à activer le service</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">service php_fpm start
</code></pre></div><p>Si vous obtenez le message <em>Starting php_fpm.</em>, c&rsquo;est parfait!</p>
<p>C&rsquo;est tout pour PHP. Maintenant passons à Nginx</p>
<h2 id="nginx">NGINX</h2>
<p>Nginx (à prononcer engine-x) est un serveur HTTP assez léger codé en C++, qui conviendra parfaitement à nos besoins de légerté concernant l&rsquo;hébergement web chez le pain de mie (le grille-pain, vous vous souvenez ?)</p>
<h3 id="installation-de-nginx">Installation de Nginx</h3>
<p>Pour installer Nginx et toute ses dépendances</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">pkgin in nginx
</code></pre></div><h3 id="configuration-de-nginx">Configuration de Nginx</h3>
<p>Comme avant, l&rsquo;installeur nous donne quelques tâches à faire pour finaliser l&rsquo;installation</p>
<pre><code class="language-console" data-lang="console">The following files should be created for nginx-1.19.2:

        /etc/rc.d/nginx (m=0755)
            [/usr/pkg/share/examples/rc.d/nginx]
</code></pre><p>On va donc copier le fichier d&rsquo;initialisation de nginx</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cp /usr/pkg/share/examples/rc.d/nginx /etc/rc.d/nginx
</code></pre></div><p>Puis éditer <code>/etc/rc.conf</code> pour y ajouter à la fin</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">nginx</span><span style="color:#f92672">=</span><span style="color:#e6db74">YES</span>
</code></pre></div><p>On peut à présent démarer Nginx</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">service nginx start
</code></pre></div><p>Si tout se passe bien, vous obenez le message <em>Starting nginx.</em></p>
<h3 id="hello-world">Hello, World</h3>
<p>Ca y est ! Vous pouvez dès à présent accéder à votre grille-pain du futur depuis votre smartphone via le navigateur. Vous allez obtenir la page par défaut de Nginx</p>
<p><img class="img-zoomable" src="/static/Nginx_welcome.png" alt="Nginx welcome" />
</p>
<p>C&rsquo;est déjà bien, mais avec ça vous ne pouvez toujours pas exécuter de PHP coté serveur. Il va falloir approfondir les configurations.</p>
<h3 id="configuration-avancée-de-nginx">Configuration avancée de Nginx</h3>
<p>On va éditer la configuration de Nginx qui se trouve dans <code>/usr/pkg/etc/nginx/nginx.conf</code>. Modifier le champs <em>server</em> pour obtenir un résultat similaire</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nginx" data-lang="nginx"><span style="color:#66d9ef">server</span> {
    <span style="color:#f92672">listen</span>       <span style="color:#ae81ff">80</span>;
    <span style="color:#f92672">server_name</span>  <span style="color:#e6db74">localhost</span>;
    <span style="color:#f92672">root</span>         <span style="color:#e6db74">/var/www</span>;
    <span style="color:#75715e">#charset koi8-r;
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">#access_log  /var/log/nginx/host.access.log  main;
</span><span style="color:#75715e"></span>
    <span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
        <span style="color:#f92672">index</span> <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span> <span style="color:#e6db74">index.php</span>;
        <span style="color:#f92672">try_files</span> $uri $uri/ <span style="color:#e6db74">/index.html</span>;
    }

    <span style="color:#75715e">#error_page  404              /404.html;
</span><span style="color:#75715e"></span>
    <span style="color:#75715e"># redirect server error pages to the static page /50x.html
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#
</span><span style="color:#75715e"></span>    <span style="color:#f92672">error_page</span>   <span style="color:#ae81ff">500</span> <span style="color:#ae81ff">502</span> <span style="color:#ae81ff">503</span> <span style="color:#ae81ff">504</span>  <span style="color:#e6db74">/50x.html</span>;
    <span style="color:#f92672">location</span> = <span style="color:#e6db74">/50x.html</span> {
        <span style="color:#f92672">root</span>   <span style="color:#e6db74">share/examples/nginx/html</span>;
    }

    <span style="color:#75715e"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#
</span><span style="color:#75715e"></span>    <span style="color:#f92672">location</span> ~ <span style="color:#e6db74">\.php$</span> {
        <span style="color:#f92672">try_files</span> $uri =<span style="color:#ae81ff">404</span>;
        <span style="color:#f92672">fastcgi_pass</span>   127.0.0.1:<span style="color:#ae81ff">9000</span>;
        <span style="color:#f92672">fastcgi_index</span>  <span style="color:#e6db74">index.php</span>;
        <span style="color:#f92672">fastcgi_param</span> <span style="color:#e6db74">SCRIPT_FILENAME</span> $document_root$fastcgi_script_name;
        <span style="color:#f92672">include</span>        <span style="color:#e6db74">/usr/pkg/etc/nginx/fastcgi_params</span>;
    }
}
</code></pre></div><p>Il est aussi nécessaire de modifier l&rsquo;utilisateur et le groupe dans la configuration de php-fpm <code>/usr/pkg/etc/php-fpm.d/www.conf</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">nginx</span>
<span style="color:#a6e22e">group</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">nginx</span>
</code></pre></div><p>Maintenant on peut redémarer les services</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">service php_fpm restart
service nginx restart
</code></pre></div><p>On peut maintenant créer un fichier dans la racine de notre serveur web <code>/var/www/index.php</code> (ou votre racine si vous en avez choisi une autre)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="color:#a6e22e">phpinfo</span>();
<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Et voilà! Vous devriez tomber sur la page d&rsquo;information PHP.</p>

    </div>
</article>




            </div>
            <aside class="col-12 col-md-3 float-left sidebar">
    
    <div class="sidebar-item sidebar-pages">
        <h3>Pages</h3>
        <ul>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-links">
        <h3>Links</h3>
        <ul>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-tags">
        <h3>Tags</h3>
        <div>
            
        </div>
    </div>
    
    
    
    
</aside>
        </div>
        <div class="btn">
    <div class="btn-menu" id="btn-menu">
        <i class="iconfont icon-grid-sharp"></i>
    </div>
    <div class="btn-toggle-mode">
        <i class="iconfont icon-contrast-sharp"></i>
    </div>
    <div class="btn-scroll-top">
        <i class="iconfont icon-chevron-up-circle-sharp"></i>
    </div>
</div>
<aside class="sidebar-mobile" style="display: none;">
  <div class="sidebar-wrapper">
    
    <div class="sidebar-item sidebar-pages">
        <h3>Pages</h3>
        <ul>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-links">
        <h3>Links</h3>
        <ul>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-tags">
        <h3>Tags</h3>
        <div>
            
        </div>
    </div>
    
    
    
    
  </div>
</aside>
    </main>

    <footer>
    <div class="container-lg clearfix">
        <div class="col-12 footer">
            <span>&copy; 2020 <a href="https://shinoyasx.github.io/"></a> |
                Powered by <a href="https://github.com/amzrk2/hugo-theme-fuji/"
                   target="_blank">Fuji-v2</a> & <a href="https://gohugo.io/"
                   target="_blank">Hugo</a> </span>
        </div>
    </div>
</footer>
    
<script defer src="https://cdn.jsdelivr.net/combine/npm/medium-zoom@1.0.6,npm/lazysizes@5.2.2"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.21.0/components/prism-core.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.21.0/plugins/autoloader/prism-autoloader.min.js"></script>



<script defer src="/assets/js/fuji.min.js"></script>


</body>

</html>